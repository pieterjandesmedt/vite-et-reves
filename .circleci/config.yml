version: 2.1
orbs:
  hugo: circleci/hugo@0.3.1
workflows:
  main:
    jobs:
      - hugo/build
      - deploy:
          requires:
            - hugo/build
          filters:
            branches:
              only: master
jobs:
  deploy:
    docker:
      - image: node:latest
    steps:
      - checkout
      - attach_workspace:
          at: built
      - run:
          name: Install and configure dependencies
          command: |
            npm install -g --silent gh-pages@latest
            git config --global user.email $GH_EMAIL
            git config --global user.name $GH_USER
      - run:
          name: Deploy built site to gh-pages branch
          command: gh-pages --dist built/public
